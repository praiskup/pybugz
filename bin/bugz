#!/usr/bin/python

"""
Python Bugzilla Interface

Simple command-line interface to bugzilla to allow:
 - searching
 - getting bug info
 - saving attachments

Requirements
------------
 - Python 2.5 or later

Classes
-------
 - BugzillaProxy - Server proxy for communication with Bugzilla
 - PrettyBugz - Command line interface to Bugzilla

"""

import locale
import os
import sys
import traceback

from bugz.argparsers import make_parser
from bugz.cli import PrettyBugz
from bugz.errhandling import BugzError

def formatError(msg):
	lines = str(msg).split('\n')
	start = True
	for line in lines:
		tmpl = ' !        %s'
		if start:
			start = False
			tmpl= ' ! Error: %s'

		print tmpl % line

def main():

	# parse options
	args = None
	parser = make_parser()
	args = parser.parse_args()

	try:
		bugz = PrettyBugz(args)
		args.func(bugz, args)
		return 0

	except BugzError, e:
		formatError(e)
		return 1

	except TypeError, e:
		# where this comes from?
		formatError('Incorrect number of arguments supplied')
		traceback.print_exc()
		return 1

	except RuntimeError, e:
		formatError(e)
		return 1

	except KeyboardInterrupt:
		print
		print 'Stopped.'
		return 1

	except:
		raise

if __name__ == "__main__":
	sys.exit(main())
